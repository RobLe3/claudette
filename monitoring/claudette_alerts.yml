groups:
- name: claudette_alerts
  rules:
  
  # High latency alert
  - alert: ClaudetteHighLatency
    expr: claudette_request_duration_seconds{quantile="0.95"} > 10
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "Claudette high latency detected"
      description: "95th percentile latency is {{ $value }}s for Claudette instance {{ $labels.instance }}"

  # High error rate alert
  - alert: ClaudetteHighErrorRate
    expr: (rate(claudette_requests_total{status=~"4..|5.."}[5m]) / rate(claudette_requests_total[5m])) > 0.05
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Claudette high error rate"
      description: "Error rate is {{ $value | humanizePercentage }} for Claudette instance {{ $labels.instance }}"

  # Backend unavailability alert
  - alert: ClaudetteBackendDown
    expr: claudette_backend_healthy{healthy="false"} == 1
    for: 30s
    labels:
      severity: warning
    annotations:
      summary: "Claudette backend unavailable"
      description: "Backend {{ $labels.backend }} is unhealthy for Claudette instance {{ $labels.instance }}"

  # No healthy backends alert
  - alert: ClaudetteAllBackendsDown
    expr: sum(claudette_backend_healthy{healthy="true"}) == 0
    for: 10s
    labels:
      severity: critical
    annotations:
      summary: "All Claudette backends down"
      description: "No healthy backends available for Claudette instance {{ $labels.instance }}"

  # High memory usage alert
  - alert: ClaudetteHighMemoryUsage
    expr: process_resident_memory_bytes > 400000000  # 400MB
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Claudette high memory usage"
      description: "Memory usage is {{ $value | humanizeBytes }} for Claudette instance {{ $labels.instance }}"

  # Cache hit rate too low
  - alert: ClaudetteLowCacheHitRate
    expr: claudette_cache_hit_rate < 0.3
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Claudette low cache hit rate"
      description: "Cache hit rate is {{ $value | humanizePercentage }} for Claudette instance {{ $labels.instance }}"

  # Cost exceeding budget alert
  - alert: ClaudetteCostBudgetExceeded
    expr: increase(claudette_cost_total[1h]) > 10  # $10 per hour
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "Claudette cost budget exceeded"
      description: "Hourly cost is ${{ $value }} for Claudette instance {{ $labels.instance }}"